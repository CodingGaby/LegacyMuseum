---
import Layout from "../../layouts/Layout.astro";
import BankAccountForm from "../../components/BankAccount/BankAccountForm.astro";
import { turso } from "src/turso";

if (Astro.request.method === 'POST') {
  const formData = await Astro.request.formData();
  const bankID = formData.get('bankID');
  const entityID = formData.get('entityID');
  const entityType = formData.get('entityType');
  const currencyID = formData.get('currencyID');
  const accountTypeID = formData.get('accountTypeID');
  const statusID = formData.get('statusID');
  const bicCode = formData.get('bicCode');
  const customerID = formData.get('customerID');

  await turso.execute(`
    INSERT INTO BankAccounts (bankID, entityID, entityType, currencyID, accountTypeID, statusID, bicCode, customerID)
    VALUES (${bankID}, ${entityID}, '${entityType}', ${currencyID}, ${accountTypeID}, ${statusID}, '${bicCode}', ${customerID})
  `);

  return Astro.redirect('/bankaccounts');
}
---

<Layout title="Add Bank Account">
  <BankAccountForm/>
</Layout>
