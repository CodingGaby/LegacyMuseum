---
import BackBtn from "../../components/ui/Buttons/BackBtn.astro";
import Layout from "../../layouts/Layout.astro";
import PurchaseForm from "../../components/Purchase/PurchaseForm.astro";
import { turso } from "src/turso";
import SubmitBtn from "../../components/ui/Buttons/SubmitBtn.astro";
import PurchaseOrderID from "./[PurchaseOrderID].astro";


if (Astro.request.method === 'POST') {
  
  const formData = await Astro.request.formData();
  const orderID = formData.get('purchaseID');
  const supplierID = formData.get('supplierID');
  const totalAmount = formData.get('totalAmount');
  const orderDate = formData.get('orderDate');

  await turso.execute(`
    INSERT INTO PurchaseOrders (purchaseID, supplierID, totalAmount, orderDate)
    VALUES (${PurchaseOrderID}, ${supplierID}, ${totalAmount})
  `);

  return Astro.redirect('/purchaseOrders');
}
---

<Layout title="purchaseOrders">
  <PurchaseForm />
  <div class="flex justify-end max-w-full mx-auto px-8">
    <BackBtn />
    <SubmitBtn>
      Add
    </SubmitBtn>
    </a>
  </div>
</Layout>