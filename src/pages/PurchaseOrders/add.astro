---
import Layout from "../../layouts/Layout.astro";
import PurchaseForm from "../../components/Purchase/PurchaseForm.astro";
import { turso } from "src/turso";

if (Astro.request.method === 'POST') {
  
  const formData = await Astro.request.formData();
  const warehouseID = formData.get('warehouse');
  const supplierID = formData.get('supplierID');
  const currencyID = formData.get('currency');
  const deliverTo = formData.get('deliverTo');
  const purchaseDate = formData.get('purchaseDate');
  const discount = formData.get('discount');
  const totalChange = formData.get('totalChange');
  const description = formData.get('description');
  formData.forEach((key,value)=>console.log(key + value))


  await turso.execute(`
    INSERT INTO PurchaseOrders (warehouseID, supplierID, currencyID, deliverTo, purchaseDate, discount, totalChange, description)
    VALUES (${warehouseID}, ${supplierID}, ${currencyID}, "${deliverTo}", ${purchaseDate}, ${discount}, ${totalChange}, "${description}")
  `).catch(()=>console.log("fall√≥"))

  return Astro.redirect('/purchaseOrders');
}
---
<Layout title="Purchase Orders">
  <PurchaseForm />
</PurchaseForm>
</Layout>

